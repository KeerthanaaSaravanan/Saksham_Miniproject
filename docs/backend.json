
{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile within the Saksham application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile. (Primary Key)"
        },
        "fullName": {
          "type": "string",
          "description": "The user's full name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "dateOfBirth": {
          "type": "string",
          "description": "The user's date of birth.",
          "format": "date-time"
        },
        "disabilityProfileId": {
          "type": "string",
          "description": "Reference to DisabilityProfile. (Relationship: UserProfile 1:1 DisabilityProfile)"
        }
      },
      "required": [
        "id",
        "fullName",
        "email",
        "dateOfBirth",
        "disabilityProfileId"
      ]
    },
    "DisabilityProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DisabilityProfile",
      "type": "object",
      "description": "Represents a user's disability profile, including specific needs and preferences.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the disability profile. (Primary Key)"
        },
        "visualImpairment": {
          "type": "boolean",
          "description": "Indicates if the user has a visual impairment."
        },
        "sld": {
          "type": "boolean",
          "description": "Indicates if the user has a Specific Learning Disability (SLD)."
        },
        "preferredLearningFormat": {
          "type": "string",
          "description": "User's preferred learning format (audio, video, text).",
          "format": "string"
        }
      },
      "required": [
        "id",
        "visualImpairment",
        "sld",
        "preferredLearningFormat"
      ]
    },
    "LearningContent": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LearningContent",
      "type": "object",
      "description": "Represents a learning content item within the Saksham application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the learning content. (Primary Key)"
        },
        "title": {
          "type": "string",
          "description": "The title of the learning content."
        },
        "subject": {
          "type": "string",
          "description": "The subject of the learning content."
        },
        "gradeLevel": {
          "type": "number",
          "description": "The grade level for which the content is appropriate."
        },
        "contentUrl": {
          "type": "string",
          "description": "URL to the learning content (e.g., video, document).",
          "format": "uri"
        },
        "format": {
          "type": "string",
          "description": "The format of the learning content (audio, video, text)."
        },
        "accessibilityFeatures": {
          "type": "array",
          "description": "Accessibility features available in the content.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "title",
        "subject",
        "gradeLevel",
        "contentUrl",
        "format",
        "accessibilityFeatures"
      ]
    },
    "Exam": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Exam",
      "type": "object",
      "description": "Represents an exam or assessment within the Saksham application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the exam. (Primary Key)"
        },
        "title": {
          "type": "string",
          "description": "The title of the exam."
        },
        "subject": {
          "type": "string",
          "description": "The subject of the exam."
        },
        "gradeLevel": {
          "type": "number",
          "description": "The grade level for which the exam is designed."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Exam)"
        },
        "questionIds": {
          "type": "array",
          "description": "References to Questions. (Relationship: Exam 1:N Question)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "title",
        "subject",
        "gradeLevel",
        "userId",
        "questionIds"
      ]
    },
    "Question": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Question",
      "type": "object",
      "description": "Represents a question within an exam.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the question. (Primary Key)"
        },
        "text": {
          "type": "string",
          "description": "The text of the question."
        },
        "options": {
          "type": "array",
          "description": "Array of possible answer options.",
          "items": {
            "type": "string"
          }
        },
        "correctAnswer": {
          "type": "string",
          "description": "The correct answer to the question."
        },
        "difficulty": {
          "type": "number",
          "description": "The difficulty level of the question (e.g., 1-5)."
        },
        "type": {
          "type": "string",
          "description": "The type of question (e.g., multiple choice, true/false)."
        }
      },
      "required": [
        "id",
        "text",
        "options",
        "correctAnswer",
        "difficulty",
        "type"
      ]
    },
    "ExamSession": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ExamSession",
      "type": "object",
      "description": "Represents a user's session during an exam, including answers and fraud detection data.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the exam session. (Primary Key)"
        },
        "examId": {
          "type": "string",
          "description": "Reference to Exam. (Relationship: Exam 1:N ExamSession)"
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N ExamSession)"
        },
        "startTime": {
          "type": "string",
          "description": "The start time of the exam session.",
          "format": "date-time"
        },
        "endTime": {
          "type": "string",
          "description": "The end time of the exam session.",
          "format": "date-time"
        },
        "answers": {
          "type": "array",
          "description": "An array of user's answers to the questions.",
          "items": {
            "type": "string"
          }
        },
        "fraudScore": {
          "type": "number",
          "description": "A score indicating the likelihood of fraudulent activity during the exam."
        },
        "anomalousPatterns": {
          "type": "array",
          "description": "An array of anomalous patterns detected during the exam session (e.g., background speech, rapid screen changes).",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "examId",
        "userId",
        "startTime",
        "endTime",
        "answers",
        "fraudScore",
        "anomalousPatterns"
      ]
    },
    "Teacher": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Teacher",
      "type": "object",
      "description": "Represents a teacher or admin user who manages content and monitors student progress.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the teacher. (Primary Key)"
        },
        "fullName": {
          "type": "string",
          "description": "The teacher's full name."
        },
        "email": {
          "type": "string",
          "description": "The teacher's email address.",
          "format": "email"
        },
        "subjectTaught": {
          "type": "string",
          "description": "The subject the teacher teaches."
        }
      },
      "required": [
        "id",
        "fullName",
        "email",
        "subjectTaught"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/profile",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. The `userId` parameter ensures path-based ownership. Represents private user data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/disability_profiles/{disabilityProfileId}",
        "definition": {
          "entityName": "DisabilityProfile",
          "schema": {
            "$ref": "#/backend/entities/DisabilityProfile"
          },
          "description": "Stores disability profiles for users. This is a top-level collection because DisabilityProfiles should be globally accessible (with appropriate security rules) for content adaptation.",
          "params": [
            {
              "name": "disabilityProfileId",
              "description": "The unique identifier of the disability profile."
            }
          ]
        }
      },
      {
        "path": "/learning_content/{contentId}",
        "definition": {
          "entityName": "LearningContent",
          "schema": {
            "$ref": "#/backend/entities/LearningContent"
          },
          "description": "Stores learning content items. This is a top-level collection for global access (subject to authorization rules).",
          "params": [
            {
              "name": "contentId",
              "description": "The unique identifier of the learning content."
            }
          ]
        }
      },
      {
        "path": "/exams/{examId}",
        "definition": {
          "entityName": "Exam",
          "schema": {
            "$ref": "#/backend/entities/Exam"
          },
          "description": "Stores exam definitions. Includes denormalized `userId` to identify the teacher that created the exam. ",
          "params": [
            {
              "name": "examId",
              "description": "The unique identifier of the exam."
            }
          ]
        }
      },
      {
        "path": "/questions/{questionId}",
        "definition": {
          "entityName": "Question",
          "schema": {
            "$ref": "#/backend/entities/Question"
          },
          "description": "Stores individual questions. Questions are global and referenced by exams.",
          "params": [
            {
              "name": "questionId",
              "description": "The unique identifier of the question."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/examSessions/{examSessionId}",
        "definition": {
          "entityName": "ExamSession",
          "schema": {
            "$ref": "#/backend/entities/ExamSession"
          },
          "description": "Stores exam session data for each user.  Path-based ownership enforced by `userId` parameter.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "examSessionId",
              "description": "The unique identifier of the exam session."
            }
          ]
        }
      },
      {
        "path": "/teachers/{teacherId}",
        "definition": {
          "entityName": "Teacher",
          "schema": {
            "$ref": "#/backend/entities/Teacher"
          },
          "description": "Stores teacher profile information. Existence in this collection implicitly grants teacher roles.",
          "params": [
            {
              "name": "teacherId",
              "description": "The unique identifier of the teacher."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/exams/{examId}",
        "definition": {
          "entityName": "Exam",
          "schema": {
            "$ref": "#/backend/entities/Exam"
          },
          "description": "Stores exam definitions created by a specific user (teacher).",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user (teacher)."
            },
            {
              "name": "examId",
              "description": "The unique identifier of the exam."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the Saksham application's features while adhering to the principles of Authorization Independence, Structural Segregation, Access Modeling, and Data Clarity. User profiles and related data are organized under user-specific paths for private data, while learning content and other global data are stored in top-level collections. \n\n**Authorization Independence:** The structure leverages path-based ownership for user-specific data. For instance, ExamSessions are stored under `/users/{userId}/examSessions/{examSessionId}`. This eliminates the need for `get()` calls in security rules to verify ownership.  Teacher profiles are stored under a `/teachers/{teacherId}` path. Exams are stored under a `/exams/{examId}` path and include a denormalized `teacherId` field.  \n\n**Structural Segregation:** Data with different access requirements are stored in separate collections.  User profiles (`/users/{userId}/profile`) are segregated from global learning content (`/learning_content/{contentId}`).  \n\n**Access Modeling:** Path-based ownership is used for user-specific data like ExamSessions.  Membership maps are not explicitly needed, as access control is managed through path ownership and `request.auth.uid`. Global roles (e.g., for teachers) are implicitly managed through their presence in the `/teachers/{teacherId}` collection.  \n\n**QAPs (Rules are not Filters):** Secure list operations are supported by the segregation of data and the use of path-based ownership. Listing exams is possible via the `/exams` collection and protected via rules that check the teacher's authorization. User specific exams can be listed via `/users/{userId}/exams`\n\n**Invariants:** Ownership (using userId), timestamps (startTime, endTime in ExamSession), and denormalized data (teacherId in Exam) are enforced through the structure and can be validated with security rules."
  }
}
